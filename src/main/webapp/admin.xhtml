<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
      
<h:head>
    <title>ניהול מוצרים</title>
   	<h:outputStylesheet library="css" name="productTable.css" rendered="#{loginBean.admin}" />
    <h:outputStylesheet library="css" name="login.css" rendered="#{not loginBean.admin}" />
    <h:outputStylesheet library="css" name="messages.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
</h:head>
<h:body>

	<ui:include src="/WEB-INF/templates/messages.xhtml"/>

	<ui:include src="/WEB-INF/templates/adminLogin.xhtml" rendered="#{not loginBean.admin}"/>

    <h:panelGroup rendered="#{loginBean.admin}" id="product-panel">

		<h:panelGroup styleClass="admin-header">
		
	        <h2>לוח ניהול מוצרים</h2>
	        
			<h:panelGroup styleClass="categorys-link">
			    <h:link outcome="categories.xhtml" class="link-button">עריכת קטגוריות←</h:link>
			    
		    	<h:link outcome="addProduct.xhtml" class="new-product-btn">+   מוצר חדש</h:link>
			    	
			    
			</h:panelGroup>
    	</h:panelGroup>
    
	    <h:form>
	
	        <h:dataTable value="#{productBean.products}" var="product" border="1" id="productTable">
				
	        	<h:column>
				    <f:facet name="header">
				            <h:selectOneMenu value="#{productBean.statusFilter}">
				                <f:selectItem itemValue="all" itemLabel="הכל" />
				                <f:selectItem itemValue="active" itemLabel="פעיל" />
				                <f:selectItem itemValue="inactive" itemLabel="לא פעיל" />
				            	<f:ajax render="productTable" execute="statusFilter"/>
			            	</h:selectOneMenu>
				    </f:facet>
				    <h:outputText value="#{product.deleted ? 'לא פעיל' : 'פעיל'}" class="#{product.deleted ? 'status-inactive' : 'status-active'}" />
				</h:column>
				
	        
	            <h:column>
	                <f:facet name="header">תמונה</f:facet>
	                <h:graphicImage value="#{product.image}" width="60"/>
	            </h:column>
	            
	            <h:column>
	                <f:facet name="header">ברקוד</f:facet>
	                #{product.barcode}
	            </h:column>
	
	            <h:column>
	                <f:facet name="header">שם מוצר</f:facet>
	                <h:inputText value="#{product.name}"  styleClass="col-name" />
	            </h:column>
	            
        	    <h:column>
	                <f:facet name="header">תיאור</f:facet>
	                <h:inputText value="#{product.description}" />
	            </h:column>

				<h:column>
				    <f:facet name="header">קטגוריה</f:facet>
				    <h:selectOneMenu value="#{product.catID}" styleClass="category-select #{product.category.deleted ? 'inactiveCat' : ''}">
				    	<f:selectItem itemLabel="#{product.category.name}" itemValue="#{product.category.id}" rendered="#{product.category.deleted}"/>
				        <f:selectItems value="#{categoryBean.allActives}" var="cat" itemLabel="#{cat.name}" itemValue="#{cat.id}" />
				    </h:selectOneMenu>
				</h:column>
	            
	
	            <h:column>
	                <f:facet name="header">מחיר</f:facet>
	                <h:inputText value="#{product.price}" styleClass="col-name"/>₪
	            </h:column>
	 
	            <h:column>
				    <f:facet name="header">פעולות</f:facet>
				    <h:commandLink value="שמור" action="#{adminBean.updateProduct(product)}" styleClass="btn-save">
				    	<i class="fa-solid fa-cloud-arrow-down" />
				    </h:commandLink>
				</h:column>
	            
     	        <h:column>
	                <f:facet name="header"></f:facet>
	                <h:commandLink action="#{adminBean.removeProduct(product)}"  rendered="#{not product.deleted}" styleClass="btn-del">
	                	<i class="fas fa-trash-can" />
	                	<f:ajax onevent="handleRefresh"/>
                	</h:commandLink>
				    <h:commandLink action="#{adminBean.restoreProduct(product)}" rendered="#{product.deleted}" styleClass="btn-reset">
    					<i class="fas fa-undo" />
	                	<f:ajax onevent="handleRefresh"/>
	                </h:commandLink>
	            </h:column>
	
	        </h:dataTable>
	    </h:form>
    </h:panelGroup>
    
    <h:outputScript>
    function handleRefresh(data) {
        if (data.status === 'success') {location.reload();}
    }
	</h:outputScript>

</h:body>
</html>
