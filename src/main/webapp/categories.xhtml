<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
      
<h:head>
    <title>ניהול מוצרים</title>
	<h:outputStylesheet library="css" name="productTable.css" rendered="#{loginBean.admin}" />
    <h:outputStylesheet library="css" name="login.css" rendered="#{not loginBean.admin}" />
    <h:outputStylesheet library="css" name="messages.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
</h:head>
<h:body>

	<ui:include src="/WEB-INF/templates/messages.xhtml"/>

	<ui:include src="/WEB-INF/templates/adminLogin.xhtml" rendered="#{not loginBean.admin}"/>

    <h:panelGroup rendered="#{loginBean.admin}">
		
        <h:panelGroup styleClass="admin-header">
        
        	<h:panelGroup styleClass="addCatForm">
		        <h2>לוח ניהול קטגוריות</h2>
	   			<h:form id="categoryForm">	
			        <h:outputLabel for="catName" value="שם הקטגוריה:" />
			        <h:inputText id="catName" value="#{adminBean.categoryName}" styleClass="newCatField"/>
			
			        <h:commandButton value="הוסף קטגוריה" action="#{adminBean.addCategory}" class="new-category-btn" />
			        <h:message for="catName" style="color:red;" showDetail="true" showSummary="false" />
			
		    	</h:form>
	    	</h:panelGroup>
	        
			<h:panelGroup styleClass="categorys-link">
			    <h:link outcome="admin.xhtml" class="link-button">עריכת מוצרים←</h:link>
			    
			</h:panelGroup>
		</h:panelGroup>
		
    
    
    	<div>

    	
    	</div>
    
    
    
    
	    <h:form>
	
	        <h:dataTable value="#{adminBean.categories}" var="category" border="1" id="categoryTable">
	
	        	<h:column>
				    <f:facet name="header">
				            <h:selectOneMenu value="#{adminBean.statusFilter}">
				                <f:selectItem itemValue="all" itemLabel="הכל" />
				                <f:selectItem itemValue="active" itemLabel="פעיל" />
				                <f:selectItem itemValue="inactive" itemLabel="לא פעיל" />
				            	<f:ajax render="categoryTable" execute="statusFilter"/>
			            	</h:selectOneMenu>
				    </f:facet>
				    <h:outputText value="#{category.deleted ? 'לא פעיל' : 'פעיל'}" class="#{category.deleted ? 'status-inactive' : 'status-active'}" />
				</h:column>
				
	            <h:column>
	                <f:facet name="header">מזהה</f:facet>
	                #{category.id}
	            </h:column>
	            
	            <h:column>
	                <f:facet name="header">שם</f:facet>
	                <h:inputText value="#{category.uptName}" />
	            </h:column>
	            
				<h:column>
				    <f:facet name="header">פעולות</f:facet>
				    <h:commandLink value="שמור" action="#{adminBean.updateCategory(category)}" styleClass="btn-save">
				    	<i class="fa-solid fa-cloud-arrow-down" />
				    </h:commandLink>
				</h:column>
	            
				<h:column>
	                <f:facet name="header"></f:facet>
	                <h:commandLink action="#{adminBean.removeCategory(category)}"  rendered="#{not category.deleted}" styleClass="btn-del">
	                	<i class="fas fa-trash-can" />
	                	<f:ajax onevent="handleRefresh"/>
                	</h:commandLink>
				    <h:commandLink action="#{adminBean.restoreCategory(category)}" rendered="#{category.deleted}" styleClass="btn-reset">
				    	<i class="fas fa-undo" />
	                	<f:ajax onevent="handleRefresh"/>
	                </h:commandLink>
	            </h:column>
	
	        </h:dataTable>
	    </h:form>
    </h:panelGroup>
    
    <h:outputScript>
    function handleRefresh(data) {
        if (data.status === 'success') {location.reload();}
    }
	</h:outputScript>

</h:body>
</html>
